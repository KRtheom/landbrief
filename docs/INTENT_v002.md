

```markdown
# Landbrief 개발 의도 (Vibe Coding Intent)

> **버전**: v0.5 (2026-02-28)
> **저장 경로**: `~/landbrief/docs/INTENT.md`
> **목적**: 바이브 코딩 세션에서 AI가 맥락을 잃지 않도록 프로젝트 의도·원칙·범위를 고정하는 문서.
> **상태**: 초안. 개발 진행에 따라 지속 수정·보완.


---

## 0) 한 문장 정의

Landbrief는 판단/해석/점수화 없이, 공공기관·KB 부동산 데이터를 동일 기준·동일 기간으로 정렬해 사용자가 스스로 판단할 수 있게 만드는 부동산 데이터 리포트 소프트웨어다. 동일 데이터 파이프라인 위에 3개 출력 트랙(PF심사자료, 투자심의, 공인중개사)을 운영한다.


---

## 1) 절대 원칙 (Do / Don't)

### Do
- 객관적 수치, 통계, 추이, 순위, 비교를 제공한다.
- 모든 그래프/표는 동일 기간(기본 36개월), 동일 단위로 정렬한다.
- 사용자 선택에 의해 비교군(A/B/C 3지역)이 결정된다.
- 지표는 **"기관명_정식명칭"**으로 표기한다(코드도 함께 유지).

### Don't (금지)
- "상승/하락/침체/회복/위험/추천" 같은 해석 문장 작성 금지.
- 점수/등급/신호등/AI 예측/투자판단/리스크 판단 결과 제공 금지.
- 원천 실거래 전체 CSV 재판매 형태(전체 DB 제공/대량 다운로드) 금지.


---

## 2) 제품 범위

### 3트랙 구조

**트랙 A: PF심사자료**
- 공인기관 12종, 36개월, A/B/C 3지역 비교.
- 출력: 웹 리포트(기본), 유료 PDF.
- Phase 1(지역 비교), Phase 2(단지 비교)가 여기 소속.

**트랙 B: 회사 투자심의용**
- 공인기관 + KB, 10년(2016~2025), 시군구 단위.
- 회사 요청 6종 기반 (섹션 5-B 참조).

**트랙 C: 공인중개사 대응**
- KB자료 중 추후 결정.

### Phase 1 (트랙 A): 지역 중심 비교 리포트
- 아파트 기준.
- 사용자 선택 3지역(A/B/C) 비교.
- 기본 기간: 36개월.
- 출력: 웹 리포트(기본), 유료 사용자만 PDF 다운로드.
- PDF는 서버가 요청 시 즉시 생성 + 캐시 재사용 (전수 생성/저장 금지).

### Phase 2 (트랙 A): 단지 중심 비교 리포트
- 단지 1개 선택 + 유사 단지 2~3개 비교.
- 유사 단지 매칭 기준: 동일 시군구 내, 준공연도 ±5년, 세대수 ±30%, 전용면적 ±10㎡.
- 매칭 후보 3개 미만 시 범위를 광역시도로 확장.
- 세대수 데이터: 별도 API 필요 (국토부 건축물대장 또는 공동주택단지 정보), Phase 2 착수 시 확보.
- 출력/유료 정책은 Phase 1과 동일.


---

## 3) 리포트 객관 요소 정의

리포트는 다음만 제공한다(설명 최소/중립 표현).

- **통계**: 표본수(n), 대표값(중앙값), 분위(25/50/75), 범위(최고/최저).
- **추이**: 월별 시계열(36개월), 최근 3/6/12개월 변화폭(수치).
- **비교**: A/B/C를 같은 축에 나란히 배치.
- **순위**: "광역 내 순위" 같은 정렬 결과(해석 문장 없이 숫자만).

※ 대표값/분위 등 계산은 Landbrief가 정의한 산식이며, 리포트 하단에 "산식/집계 기준"을 고지한다.


---

## 4) 데이터 원칙

### 수집 vs 활용
- **수집**: 미래 확장을 위해 넓게 가져간다(주거 전 유형/토지/상업 등 포함 가능).
- **활용(Phase 1)**: 아파트 중심 최소 세트로 시작한다.

### 거래량 우선순위
- 리포트 섹션 2(거래)에서는 APT_SALE_DTL/APT_RENT 원천 실거래 건수 집계(Landbrief 자체 산출)를 1차로 사용한다.
- REB_TRADE_VOLUME(R-ONE 집계)은 교차 검증용 참고값으로 병기한다.

### 결측 표현 정책
- **월별 지표 결측**: 그래프에서 해당 월 점 생략(선 끊김), 표에서 "-" 표기.
- **반기/분기 지표 비갱신 월**: 직전 유효값 캐리 (SUPPLY_INCOMING, HF_PIR 등).
- **전체 기간 결측인 지표**: 해당 섹션을 "데이터 미제공" 문구로 대체.

### 인구이동 데이터 (Phase 1 미사용)
- 행안부 인구이동 API(selectPpltnDataStus) 제약: 10자리 행정기관코드 필수, 전입/전출 양쪽 지정 필수(빈값 불가), 전국 일괄 조회 불가(쌍 단위 호출), 3개월 단위 제한.
- Phase 1에서는 핵심 의존을 피하고, 인구/세대 증감을 기본 수요 맥락으로 둔다.
- 향후 검토.

### 평단가 산출 방식
- 실거래 API는 전용면적만 제공, 공급면적 없음.
- 시군구별 평단가: KB ㎡당매매평균가격 사용 (PublicDataReader, 공급면적 기준).
- 단지별 평단가: 사용자 조회 시 KB에서 가져와 캐시.
- 단지 식별: apt_seq 활용 (41,176개 고유 단지 확인).
- 한국부동산원 공동주택 단지 식별정보 API: 면적 정보 없음 (단지ID, 주소, 세대수만).


---

### 5) 지표 목록

> API 제공기관 = API 키 기준 (데이터 원천 기관과 다를 수 있음)

| # | 코드 | API 제공기관 (키 기준) | API 정식명칭 | Phase 1 활용 | 갱신주기 | 비고 |
|---|------|----------------------|------------|-------------|---------|------|
| 1 | APT_SALE_DTL | 공공데이터포털 | 국토교통부_아파트매매 실거래가 상세자료 | ✅ 가격/거래 | 월별 | DATA_GO_KR_API_KEY |
| 2 | APT_RENT | 공공데이터포털 | 국토교통부_아파트 전월세 실거래자료 | ✅ 가격/거래 | 월별 | DATA_GO_KR_API_KEY |
| 3 | REB_SALE_PRICE_INDEX | 한국부동산원 R-ONE | 한국부동산원 R-ONE 매매가격지수 | ✅ 가격 | 월별 | REB_API_KEY |
| 4 | REB_TRADE_VOLUME | 한국부동산원 R-ONE | 한국부동산원 R-ONE 매매거래량 | ✅ 교차검증 | 월별 | REB_API_KEY, 1차는 실거래 집계 |
| 5 | REB_RENT_PRICE_INDEX | 한국부동산원 R-ONE | 한국부동산원 R-ONE 전세가격지수 | ✅ 가격 | 월별 | REB_API_KEY |
| 6 | UNSOLD_UNITS_SIGUNGU | 국토교통부 통계누리 | 국토교통부 통계누리 미분양현황 | ✅ 공급 | 월별 | MOLIT_STAT_API_KEY |
| 7 | UNSOLD_UNITS_COMPLETED | 국토교통부 통계누리 | 국토교통부 통계누리 준공후미분양 | ✅ 공급 | 월별 | MOLIT_STAT_API_KEY |
| 8 | MACRO_BASE_RATE | 한국은행 ECOS | 한국은행 ECOS 기준금리 | ✅ 매크로 | 변동 시 | ECOS_API_KEY |
| 9 | ~~HF_PIR~~ | ~~한국주택금융공사 HOUSTAT~~ | ~~한국주택금융공사_지역별 PIR 및 LIR~~ | 드랍 (세션 11) | ~~분기~~ | ~~HOUSTAT_API_KEY~~ |
| 10 | DEMO_POPULATION | 공공데이터포털 | 행정안전부_법정동별 주민등록 인구 및 세대현황 | ✅ 수요 | 월별 | DATA_GO_KR_API_KEY |
| 11 | DEMO_HOUSEHOLD | 공공데이터포털 | 행정안전부_법정동별 주민등록 인구 및 세대현황 | ✅ 수요 | 월별 | DATA_GO_KR_API_KEY |
| 12 | SUPPLY_INCOMING | 공공데이터포털 | 청약홈 분양정보 API | ✅ 공급(스냅샷) | 반기 | APPLYHOME, 서비스키 #15098547, odcloud 경유 |

### 5-A) KB 지표 (PublicDataReader 경유, API키 불필요)

| # | 코드 | 지표명 | 지역 수준 | 시작년 | 검증 |
|---|------|--------|----------|--------|------|
| 1 | KB_AVG_PRICE_PER_SQM | ㎡당매매평균가격 | 시군구 | 2004 | ✅ |
| 2 | KB_PRICE_INDEX_CHANGE | 가격지수증감률 | 시군구 | 1986 | ✅ |
| 3 | KB_JEONSE_RATIO | 전세가격비율 | 시군구 | 1998 | ✅ |
| 4 | KB_RENT_CONVERSION | 전월세전환율 | 시도 | 2015 | ✅ |
| 5 | KB_BUYER_INDEX | 매수우위지수 | 시도 | 2000 | ✅ |
| 6 | KB_PRICE_OUTLOOK | 매매가격전망지수 | 시도 | 2013 | ✅ |
| 7 | KB_MEDIAN_PRICE | 중위가격 | 시도 | 2008 | ✅ |
| 8 | KB_SIZE_PRICE_INDEX | 면적별가격지수 | 시도 | 2013 | ✅ |
| 9 | KB_PRICE_INDEX_MONTHLY | 가격지수(월간매매) | - | - | ❌ 파라미터 재확인 |
| 10 | KB_PIR | PIR | - | - | ❌ 메뉴코드 누락 |

- 수집 방식: 전국 17회 호출 (시도당 1회, 전 시군구 일괄 반환).
- 갱신: 월간 기본, 일부 주간 가능 (월간주간구분코드 파라미터).

### 5-B) 회사 요청 6종 (트랙 B, 기간 2016~2025)

| 요청 | 소스 | 긴급도 |
|---|---|---|
| 시별 인구 | MOIS 공공데이터 | 3/5전 |
| 시별 거래량 | fact_trade_raw COUNT | 수집후 산출 |
| 시별 분양물량 | 미확정(SUPPLY_INCOMING) | 확인필요 |
| 시별 미분양물량 | STAT_MOLIT 공공데이터 | 3/5전 |
| 시별 평균평단가 | KB ㎡당평균가격 (공급면적기준) | KB확정 |
| 단지별 전년도 평단가 | KB 캐시방식 | KB확정 |


---

## 6) 리포트 구성 (Phase 1)

상단: 지역 A/B/C + 기간(36개월) + 데이터 기준월(스냅샷 월)

섹션 1 [가격] 매매/전월세 대표값 시계열 + 분포(분위/표본수)

섹션 2 [거래] 월 거래건수 시계열 + 최근 12개월 누적(표본수) 1차: 실거래 건수 집계 / 참고: REB_TRADE_VOLUME 병기

섹션 3 [공급] 미분양/준공후미분양 시계열 입주예정물량 (반기 스냅샷 — 비갱신 월은 직전값 캐리)

섹션 4 [수요] 인구/세대 시계열

섹션 5 [매크로] 기준금리 시계열 (GLOBAL, 3지역 공통)

하단 고지: 출처/갱신일/집계 기준(면적필터, 표본 기준 등) "본 리포트의 산식/집계 기준은 Landbrief 자체 정의이며, 공식 통계와 차이가 있을 수 있습니다."
```


---

## 7) PDF 정책 (유료만)

- PDF는 "저장 상품"이 아니라 "출력 형식".
- 전수 생성 금지.
- 요청 시 생성 후 캐시 재사용(동일 조건이면 재생성 금지).
- 캐시 무효화: 데이터 기준월이 갱신되면 해당 조건의 캐시 자동 폐기. 동일 기준월 내 재요청은 캐시 반환.
- 기본 3페이지 레이아웃(인쇄 품질 고정).


---

## 8) 데이터 갱신 주기

| 주기 | 지표 |
|------|------|
| 월별 | APT_SALE_DTL, APT_RENT, REB 3종, UNSOLD 2종, DEMO 2종 |
| 변동 시 | MACRO_BASE_RATE |
| 반기 | SUPPLY_INCOMING |
| 월간(KB) | KB 8종 (일부 주간 가능) |

- ETL 실행: 매월 1일 03:00 KST (cron).
- 반기 지표: 갱신 감지 시 수동 트리거 또는 별도 스케줄.


---

## 9) 기술 스택 (후보 — 미확정)

### Backend
| 항목 | 후보 A | 후보 B |
|------|--------|--------|
| 언어 | Python 3.12 | — |
| 프레임워크 | FastAPI | Django REST |
| DB 접근 | raw SQL + db_utils | SQLAlchemy |
| 스케줄러 | cron + 자체 스크립트 | Celery |

### Database
| 단계 | 선택 | 비고 |
|------|------|------|
| 개발/운영 | PostgreSQL | SQLite 경유 없이 바로 |
| 마이그레이션 | 자체 SQL 스크립트 (후보) / Alembic (대안) | |

### Frontend
| 항목 | 후보 A | 후보 B |
|------|--------|--------|
| 프레임워크 | Next.js | Nuxt |
| 차트 | Apache ECharts | Chart.js / Recharts |
| PDF 생성 | WeasyPrint | Puppeteer |

### Infra
| 항목 | 값 |
|------|------|
| OS | Ubuntu 24.04.4 LTS |
| 웹서버 | Nginx reverse proxy |
| 프로세스 | systemd (API) + PM2 (Next.js) |
| 백업 | Synology rsync |

### 미확정
- 인증/결제: 미정 (Phase 1 MVP 이후)
- 모니터링: 미정 (Sentry 후보)
- CI/CD: 미정 (GitHub Actions 후보)

### 데이터 수집 라이브러리
- PublicDataReader: KB 지표 수집용, 무료, API키 불필요, pip install PublicDataReader.


---

## 10) 용어 사전

| 용어 | 정의 |
|------|------|
| 대표값 | 해당 월 실거래 건의 중앙값(median) |
| 분위 | 25th / 50th / 75th 백분위수 |
| 표본수(n) | 집계 대상 실거래 건수 |
| 변화폭 | 현재월 값 − 비교월 값 (절대 수치, 해석 없음) |
| 스냅샷 | 특정 시점의 일괄 데이터 (반기 지표 등) |
| 직전값 캐리 | 신규 데이터 없는 월에 직전 유효값을 유지 (반기/분기 지표) |
| 데이터 기준월 | 리포트에 반영된 최신 데이터의 기준 연월 |
| 공급면적 | 전용면적 + 주거공용면적. KB 평단가 산출 기준. |


---

## 11) 바이브 코딩 세션 시작 프롬프트

아래를 그대로 붙여넣는다:

```
너는 Landbrief를 개발하는 코딩 파트너다. 우리는 판단/점수/예측을 제공하지 않고, 공공기관·KB 데이터를 정렬해 3개 트랙(PF심사자료, 투자심의, 공인중개사)의 비교 리포트를 만든다. 웹 리포트가 기본이고, 유료 사용자만 PDF 다운로드를 제공한다. PDF는 요청 시 즉시 생성하고 동일 조건은 캐시 재사용한다. 코드/문서/출력에서 해석 문장(상승/침체/추천/위험 등)을 금지하고, 기관명_정식지표명 표기를 유지해라. docs/INTENT.md와 docs/DECISIONS.md를 반드시 참조해라.
```


---

*끝. 개발 진행에 따라 지속 수정·보완.*
```