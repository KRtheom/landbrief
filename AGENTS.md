
# AGENTS.md

이 문서는 `landbrief` 프로젝트에서 Codex가 세션 전반에 따라야 할 작업 운영 규칙을 정의한다.

## 1) 작업 전 공유 원칙
- 코드/명령 실행 전에 아래 4가지를 짧게 먼저 공유한다.
  - 이번 작업에서의 핵심 가정
  - 주요 리스크
  - 개선안 또는 대안(있을 때)
  - 확인된 오류 후보(있을 때)
- 고위험 작업(스키마 변경, 대량 데이터 수정, 운영 영향 명령)은 실행 전에 반드시 사전 고지한다.
- 지시서에 명시된 파일 경로, 컬럼명, 함수명, DDL 구조 등이 실제와 다를 경우:
  - **고위험 불일치** (dedup 키 구성, 테이블 구조, 이관 대상 변경 등): 작업 착수 전에 불일치를 보고하고 확인을 받는다.
  - **경미한 불일치** (컬럼명 alias, 파일 경로 차이 등): 가정을 명시하고 진행한 뒤 결과에 기재한다.

## 2) 작업 중 보정 원칙
명백한 오류나 회귀 위험을 발견하면 즉시 보정하고, 무엇을 왜 수정했는지 바로 보고한다.
문서와 코드가 불일치하면 코드 정본 기준으로 판단하고, 필요한 문서 보정안을 함께 제시한다.
검증 가능한 변경은 테스트/점검 결과를 남긴다.
검증성 작업 및 지시서 기반 작업에는 아래 3항을 필수 포함한다. 소규모 수정, 단순 질의 등에는 적용하지 않는다.
자율 추가 항목: 지시 범위 외에 발견한 이슈를 자체 추가하여 검증한다.
소스 확인 사항: 지시서 전제와 실제 코드/스키마 불일치 시 결과에 명시한다.
개선 제안: 구조적 개선점을 발견하면 결과 말미에 별도 섹션으로 기재한다.
검증성 작업이란: 데이터 검증 배치, 이관 전 점검, DDL 정합성 확인, 운영 cron 점검, 리포트 생성 스크립트 등 결과의 정확성을 보증해야 하는 작업을 말한다.

## 3) Landbrief + LandScanner 연계 원칙
- 기본 작업 기준은 `landbrief` 로컬 저장소로 한다.
- 연계 검증이 필요할 경우 `LandScanner` 원격 서버(`deploy@122.45.64.200`, `~/real_estate_report`) 조회를 허용한다.
- LandScanner 소스 파일 수정은 원칙적으로 금지한다. 단, 사용자가 명시적으로 승인한 경우에 한해 허용한다.
- 원격 서버 **쓰기 작업**(파일 생성, cron 변경, DB 변경 등)은 실행 전에 반드시 사전 고지한다.
- 원격 DB 작업은 읽기 전용을 우선한다.

## 4) 세션 컨텍스트 한계 대응
- 컨텍스트 누적이 커져 세션 분리가 유리해지는 시점이면 사전에 사용자에게 알린다.
- 새 채팅으로 전환이 필요할 때 아래 요약을 제공한다.
  - 현재 상태 요약
  - 완료/미완 태스크
  - 다음 액션
  - 주의사항/리스크

## 5) HANDOVER 문서 수정 규칙
- `docs/handover/*` 수정 안내 시 줄 단위 지시나 diff 설명 대신, 섹션 단위 전체 교체 블록을 제공한다.

## 6) 작업 후 문서 업데이트/보고 규칙
- 코드 작업이 끝나면 최종 보고 전에 문서 업데이트 필요 여부를 먼저 점검한다.
- 점검 대상 규정 문서: `docs/handover/*`, `docs/ERROR_CODE_HANDLING.md`, `docs/API_SPEC*.md`, `docs/DDL.md`, `DECISIONS.md`.
- 문서 반영이 필요하면 코드 작업과 같은 세션에서 즉시 업데이트하고 결과를 함께 보고한다.
- 문서 반영이 없을 때도 반드시 `문서 업데이트: 불필요(사유)`를 명시한다.
- 문서 반영이 있을 때는 최소한 아래를 포함해 보고한다.
  - 변경 파일 목록
  - 변경된 섹션 제목
  - 코드 변경과의 정합성 근거

## 7) Python 스크립트 산출물 규칙
검증/유틸 스크립트: 표준 라이브러리만으로 실행 가능해야 한다. 외부 패키지가 필요한 경우 사전 고지한다.
ETL/수집/서비스 코드: 프로젝트 의존성(requests, psycopg2 등) 사용을 허용한다. 새로운 외부 패키지 추가 시 사전 고지한다.
신규 또는 수정된 Python 스크립트는 실행 말미에 py_compile.compile() 자가 검증을 포함한다. 기존 미수정 파일에는 적용하지 않는다.
검증성/배치 작업의 실행 결과는 stdout 출력과 동시에 logs/ 디렉토리에 파일로 저장한다. 소규모 스크립트는 stdout만으로 충분하다.